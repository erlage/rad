import 'package:meta/meta.dart';
import 'package:rad/src/core/common/constants.dart';
import 'package:rad/src/include/foundation/hash_codes.dart';
import 'package:rad/src/widgets/abstract/widget.dart';

/// A [Key] is an identifier for [Widget]s.
///
/// Most of the time, framework takes care of generating keys for you.
///
/// Keys must be unique amongst the [Widget]s with the same parent. By
/// contrast, [GlobalKey]s must be unique across entire document.
///
@immutable
class Key {
  final String _value;

  /// Value of key that was used to while creating key.
  ///
  String get value => _value;

  /// Whether value of key is using system reserved prefix.
  ///
  /// Reserved prefix is added to keys that are generated by the framework.
  ///
  bool get hasSystemPrefix => _value.startsWith(Constants.contextGenKeyPrefix);

  /// Simplest way to create a key.
  ///
  /// Keys must be unique amongst the [Widget]s with the same parent. By
  /// contrast, [GlobalKey]s must be unique across entire document.
  ///
  const Key(this._value);

  /// Returns a global key.
  ///
  const Key._global(this._value);

  @override
  operator ==(Object other) {
    if (other.runtimeType != runtimeType) {
      return false;
    }

    return other is Key && other.value == value;
  }

  @override
  get hashCode => hashValues(runtimeType, value);

  @override
  toString() => value;
}

/// A key that is unique within the entire document.
///
class GlobalKey extends Key {
  /// Creates a global key.
  ///
  /// Constructing code must be responsible for providing a value that's unique
  /// within entire document(i.e withing multiple app instances).
  ///
  const GlobalKey(String value) : super._global(value);
}
